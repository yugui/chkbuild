#!/usr/bin/env ruby

require 'build'

Build.def_perm_target("coretest") {|b|
  FileUtils.cp(`which ruby`.chomp, "ruby")
  Build.run("./ruby", "-e", <<'End')
Process.setrlimit(Process::RLIMIT_CORE, Process::RLIM_INFINITY, Process::RLIM_INFINITY)
trap("SEGV", "DEFAULT")
Process.kill("SEGV", $$)
End
}

Build.main
