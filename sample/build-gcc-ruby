#!/usr/bin/env ruby

require 'build'
require 'chkbuild/ruby'

Build.limit(:data=>1024*1024*600, :as=>1024*1024*600)

GCC = Build.target("gcc",
  ["trunk", "trunk"],
  ["4.1", "branches/gcc-4_1-branch"],
  ["4.0", "branches/gcc-4_0-branch"],
  :old => 1) {
    |gcc_dir, gcc_version, gcc_branch|
  Dir.chdir("..") {
    Build.svn("svn://gcc.gnu.org/svn/gcc/#{gcc_branch}", 'gcc')
  }
  Build.mkcd("objdir")
  Build.run("../../gcc/configure", "--prefix=#{gcc_dir}", "--enable-languages=c", "--disable-shared", "--disable-multilib")
  Build.make("bootstrap", "install", :timeout=>'5h')
  Build.run("#{gcc_dir}/bin/gcc", '-v') {|log|
    if /^gcc version (.*)$/ =~ log
      Build.update_title(:version, "gcc #{$1}")
    end
  }
}

build_ruby2(
  ["trunk", "1.8"],
  [nil, "o3"],
  [nil, "pth"],
  GCC,
  :old => 1)
